var __decorate=this&&this.__decorate||function(e,t,r,a){var n,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);r.prototype=t.prototype,e.prototype=new r},TOWER_OF_BABEL;!(function(e){var t=(function(){function e(){}return e.instance=function(t,r,a){for(var n,s=0,o=e.MODULES.length;s<o;s++)if(t===e.MODULES[s].getModuleName()){n=e.MODULES[s].instance(r,a);break}return n||BABYLON.Tools.Error("MeshFactory.instance:  module ("+t+") not loaded"),n},e})();t.MODULES=new Array,e.MeshFactory=t})(TOWER_OF_BABEL||(TOWER_OF_BABEL={}));var QI;!(function(e){var t=(function(){function e(){}return e.compile=function(t,r,a){var n=e._getMesh(r);n.material=t,t.forceCompilation(n,a)},e._getMesh=function(t){if(e._mesh)return e._mesh;var r=new BABYLON.Mesh("mat pre-compiler",t);return r.setVerticesData(BABYLON.VertexBuffer.PositionKind,new Float32Array([0,0,0])),r.setIndices([0,0,0]),e._mesh=r},e})();e.MaterialPreCompiler=t})(QI||(QI={}));var TOWER_OF_BABEL;!(function(e){var t=(function(){function e(e,t){this.jsPath=e,this.matPath=t,this._characters={},this._busts={},this._sceneChunks={},this.jsPath.lastIndexOf("/")+1!==this.jsPath.length&&(this.jsPath+="/"),this.matPath.lastIndexOf("/")+1!==this.matPath.length&&(this.matPath+="/")}return e.prototype.addCharacter=function(e,t){e._preloader=this,this._characters[t]=e},e.prototype.addBust=function(e,t){e._preloader=this,this._busts[t]=e},e.prototype.addSceneChunk=function(e,t){e._preloader=this,this._sceneChunks[t]=e},e.addtextureBuffer=function(t){e._images.push(t)},e.findTextureBuffer=function(t){for(var r=0,a=this._images.length;r<a;r++)if(e._images[r].fName===t)return e._images[r];return null},Object.defineProperty(e.prototype,"numCharacters",{get:function(){return Object.keys(this._characters).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numBusts",{get:function(){return Object.keys(this._busts).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSceneChunks",{get:function(){return Object.keys(this._sceneChunks).length},enumerable:!0,configurable:!0}),e.prototype.getCharacterKeys=function(){return Object.keys(this._characters)},e.prototype.getBustKeys=function(){return Object.keys(this._busts)},e.prototype.getSceneChunkKeys=function(){return Object.keys(this._sceneChunks)},e.prototype.prepRemainingCharacters=function(){this._prepRemaining(this._characters)},e.prototype.prepRemainingBusts=function(){this._prepRemaining(this._busts)},e.prototype.prepRemainingSceneChunks=function(){this._prepRemaining(this._sceneChunks)},e.prototype._prepRemaining=function(e){for(var t in e)e[t].makeReady()},e.prototype.pickCharacter=function(e){return this._pick(this._characters,e)},e.prototype.pickBust=function(e){return this._pick(this._busts,e)},e.prototype._pick=function(e,t){return"undefined"==typeof t?this._getNth(e,Math.floor(Math.random()*Object.keys(e).length)):"string"==typeof t?e[t]:this._getNth(e,t)},e.prototype._getNth=function(e,t){var r=0;for(var a in e)if(r++===t)return e[a];return null},e})();t.READ_AHEAD_LOGGING=!1,t.MAKE_MULTI_SCENE=!1,t._images=new Array,e.Preloader=t})(TOWER_OF_BABEL||(TOWER_OF_BABEL={}));var TOWER_OF_BABEL;!(function(TOWER_OF_BABEL){var PreLoadable=(function(){function PreLoadable(e,t){this.moduleName=e,this._jsFile=t,this._onPath=!1,this._inProgress=!1}return PreLoadable.prototype.makeReady=function(readyCallback){var _this=this;if(this._onPath)return readyCallback&&readyCallback(),!0;if(this._inProgress)return this._userCallback||(this._userCallback=readyCallback),!1;this._inProgress=!0,this._loadStart=BABYLON.Tools.Now,readyCallback&&(this._userCallback=readyCallback);var jsElem=document.createElement("script");jsElem.type="application/javascript",jsElem.src=this._preloader.jsPath+this._jsFile,document.body.appendChild(jsElem);var ref=this;return jsElem.onload=function(){ref._onPath=ref._inProgress=!0,TOWER_OF_BABEL.Preloader.READ_AHEAD_LOGGING&&BABYLON.Tools.Log(ref._jsFile+" loaded in "+((BABYLON.Tools.Now-ref._loadStart)/1e3).toFixed(3)+" secs");try{eval(ref.moduleName+'.matReadAhead("'+ref._preloader.matPath+'");')}catch(err){BABYLON.Tools.Error("TOWER_OF_BABEL.PreLoadable: module "+ref.moduleName+".matReadAhead() failed")}ref._userCallback&&_this._userCallback(),ref._userCallback=null},jsElem.onerror=function(){BABYLON.Tools.Error("TOWER_OF_BABEL.PreLoadable: "+jsElem.src+" failed to load.")},!1},PreLoadable})();TOWER_OF_BABEL.PreLoadable=PreLoadable;var Character=(function(_super){function Character(e,t,r){var a=_super.call(this,e,t)||this;return a.className=r,a}return __extends(Character,_super),Character.prototype.instance=function(name){if(!this._onPath)return BABYLON.Tools.Error("TOWER_OF_BABEL.Character: Not correctly made ready."),null;var ret;return eval("ret = new "+this.moduleName+"."+this.className+'("'+name+'", TOWER_OF_BABEL.Preloader.SCENE, "'+this._preloader.matPath+'")'),ret},Character})(PreLoadable);TOWER_OF_BABEL.Character=Character;var SceneChunk=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.instance=function(e){if(!this._onPath)return void BABYLON.Tools.Error("TOWER_OF_BABEL.SceneChunk: Not correctly made ready.")},t})(PreLoadable);TOWER_OF_BABEL.SceneChunk=SceneChunk})(TOWER_OF_BABEL||(TOWER_OF_BABEL={}));var TOWER_OF_BABEL;!(function(e){var t=(function(){function t(e,t){this.path=e,this.fName=t,this._buffer=null,this._fetchStart=BABYLON.Tools.Now,this.path.lastIndexOf("/")+1!==this.path.length&&(this.path+="/"),this._load(!1)}return t.prototype._load=function(t){var r=null,a=this,n=this.path+this.fName,s=e.Preloader.SCENE.getEngine().textureFormatInUse,o=n.lastIndexOf("."),i=!t&&s;i&&(n=n.substring(0,o)+s,r=function(){a._load(!0)}),i?BABYLON.Tools.LoadFile(n,(function(e){a._notifyReady(e)}),null,e.Preloader.SCENE.database,!0,r):BABYLON.Tools.LoadImage(n,(function(e){a._notifyReady(e)}),r,e.Preloader.SCENE.database)},t.prototype._notifyReady=function(t){this._buffer=t,e.Preloader.READ_AHEAD_LOGGING&&BABYLON.Tools.Log(this.fName+" fetched in "+((BABYLON.Tools.Now-this._fetchStart)/1e3).toFixed(3)+" secs"),this._userCallback&&this._assign(this._userCallback)},t.prototype.applyWhenReady=function(e,t,r){this._mat=e,this._txType=t,this._buffer?this._assign(r):this._userCallback=r},t.prototype._assign=function(r){var a=new BABYLON.Texture(this.path+this.fName,e.Preloader.SCENE,(!1),(!0),BABYLON.Texture.TRILINEAR_SAMPLINGMODE,r,null,this._buffer);switch(this._buffer&&!e.Preloader.MAKE_MULTI_SCENE&&delete this._buffer,a.name=this.fName,a.hasAlpha=this.hasAlpha,a.level=this.level,a.coordinatesIndex=this.coordinatesIndex,a.coordinatesMode=this.coordinatesMode,a.uOffset=this.uOffset,a.vOffset=this.vOffset,a.uScale=this.uScale,a.vScale=this.vScale,a.uAng=this.uAng,a.vAng=this.vAng,a.wAng=this.wAng,a.wrapU=this.wrapU,a.wrapV=this.wrapV,this._txType){case t.DIFFUSE_TEX:this._mat.diffuseTexture=a;break;case t.BUMP_TEX:this._mat.bumpTexture=a;break;case t.AMBIENT_TEX:this._mat.ambientTexture=a;break;case t.OPACITY_TEX:this._mat.opacityTexture=a;break;case t.EMISSIVE_TEX:this._mat.emissiveTexture=a;break;case t.SPECULAR_TEX:this._mat.specularTexture=a;break;case t.REFLECTION_TEX:this._mat.reflectionTexture=a}},t})();t.DIFFUSE_TEX=0,t.BUMP_TEX=1,t.AMBIENT_TEX=2,t.OPACITY_TEX=3,t.EMISSIVE_TEX=4,t.SPECULAR_TEX=5,t.REFLECTION_TEX=6,e.TextureBuffer=t})(TOWER_OF_BABEL||(TOWER_OF_BABEL={})),("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=TOWER_OF_BABEL);